---
title: "HW 5"
Author: "Kelly Wang, kzw2102"
output: github_document
---

# Problem 1
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(rvest)

set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
```
* fill in missing numeric values with the mean of the non-missing values
* character variables, fill in missing values with "virginica"


* writing a function that takes a vector as an argument 
* replaces missing values using rules defined above 
* returns the returning vector
* applying this function to the columns of iris_meaning_missing using map statement 

```{r function}
replace_missing = function(x) {
  if (is.character(x)) {
    x=replace(x, is.na(x), "virginica")
  } else {
    mean_x=mean(x, na.rm=TRUE)
    x=replace(x, is.na(x), mean_x)
  }
}

output = map_dfr(iris_with_missing, replace_missing)

output

```

## Problem 2

```{r}
#TA wise words
data_problem2=tibble(
  files=list.files(path="./data/data"),
  path=str_c("./data/data/",files)
) %>% 
  mutate(data = map(path, read_csv)) %>% 
  unnest()

## change file names to include control arm and subject ID
## make sure weekly observations are tidy
data_problem2_tidy= 
  data_problem2 %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    week_1:week_8,
    names_to="Week",
    names_prefix="week_",
    values_to="Observation"
  ) %>% 
  select(files, Week, Observation) %>% 
  mutate(
    Arm = str_replace(files,"_[0-9][0-9].csv",""),
    Arm = recode(Arm, "con"="Control", "exp"="Experiment"),
    ID = str_replace(files, ".csv", " ")
  ) %>% 
  select(ID, Arm, Week, Observation, -files)
  

# spaghetti plot by group
data_problem2_tidy %>% 
  ggplot(aes(x = Week, y = Observation, group = ID, color= Arm)) + 
  geom_line() +
  labs(
    title = "Individual Observation over 8-Week Period"
  )
```


### Problem 3:
```{r}
sim_regression = function(n=30, beta0 = 2, beta1 = 0) {
  
  sim_data = tibble(
    x = rnorm(n, mean = 0, sd = sqrt(50)),
    y = beta0 + beta1 * x + rnorm(n, 0, 50)
  )
  
  ls_fit = lm(y ~ x, data = sim_data) %>% 
    broom::tidy() %>% 
    select(term, estimate, p.value)

}

sim_results = 
  tibble(beta1 = 0:6) %>% 
  mutate(
    output_lists=map(.x=beta1, ~rerun(10000, sim_regression(n=.x)))
  ) %>% 
  select(-output_lists) %>% 
  unnest()

  rerun(10000, sim_regression(30, 2, beta1)) %>% 
  bind_rows()
```
### Proportion of times the null was rejected (the power of the test) on the y axis and true value of beta2 on the xaxis. Relationship between effect size and power

### Plot showing the average estimate of beta1 on y axis and true value of beta1 on the xaxis with another plot showing average estimate of beta1 only in samples in which the null was rejected on the y axis and true value of beta1 on the x axis. 